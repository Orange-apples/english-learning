<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cxylm.springboot.dao.AppUserMapper">

    <select id="findByMobile" resultType="com.cxylm.springboot.model.AppUser">
        SELECT * FROM app_user WHERE mobile = #{mobile} AND merchant = #{merchant}
    </select>

    <select id="findByUsername" resultType="com.cxylm.springboot.model.AppUser">
        SELECT * FROM app_user WHERE username = #{username} AND merchant = #{merchant}
    </select>

    <select id="getUserListByManage" resultType="com.cxylm.springboot.dto.UserManageDto">
        select au.id, au.merchant, au.mobile, au.username, au.nickname, au.avatar, au.gender, au.account_state,
        au.create_time, au.school_id, au.wx_open_id
        from app_user au
        <where>
            au.merchant = 0
            <if test="searchForm.phone!=null and searchForm.phone!=''">
                and au.mobile LIKE #{searchForm.phone}"%"
            </if>
            <if test="searchForm.username!=null and searchForm.username!=''">
                and au.username LIKE #{searchForm.username}"%"
            </if>
            <if test="searchForm.state != null and searchForm.state != -1">
                and au.account_state = #{searchForm.state}
            </if>
        </where>
        order by au.id desc
    </select>

    <update id="blockOrRecover">
        update app_user
        set account_state = #{state}
        where id = #{userId}
    </update>
</mapper>
